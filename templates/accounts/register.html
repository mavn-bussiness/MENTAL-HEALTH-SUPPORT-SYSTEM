<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join MindCare - Start Your Mental Health Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Sliding background images */
      .sliding-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .slide {
        position: absolute;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0;
        animation: slideShow 25s infinite;
      }

      .slide:nth-child(1) {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.1'%3E%3Cpolygon fill='%23ffffff' points='50 0 60 40 100 50 60 60 50 100 40 60 0 50 40 40'/%3E%3C/g%3E%3C/svg%3E");
        background-color: #1e40af;
        animation-delay: 0s;
      }

      .slide:nth-child(2) {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.1'%3E%3Cpath fill='%23ffffff' d='M50 5A45 45 0 1 0 50 95A45 45 0 1 0 50 5zm0 10A35 35 0 1 1 50 85A35 35 0 1 1 50 15z'/%3E%3C/g%3E%3C/svg%3E");
        background-color: #2563eb;
        animation-delay: 6s;
      }

      .slide:nth-child(3) {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.1'%3E%3Cpath fill='%23ffffff' d='M50 10L60 40L90 50L60 60L50 90L40 60L10 50L40 40Z'/%3E%3C/g%3E%3C/svg%3E");
        background-color: #1d4ed8;
        animation-delay: 12s;
      }

      .slide:nth-child(4) {
        background-image: linear-gradient(
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.6)
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-opacity='0.1'%3E%3Cpath fill='%23ffffff' d='M25 25h50v50h-50z'/%3E%3C/g%3E%3C/svg%3E");
        background-color: #1e3a8a;
        animation-delay: 18s;
      }

      @keyframes slideShow {
        0% {
          opacity: 0;
          transform: scale(1.1);
        }
        20% {
          opacity: 1;
          transform: scale(1);
        }
        40% {
          opacity: 1;
          transform: scale(1);
        }
        60% {
          opacity: 0;
          transform: scale(1.1);
        }
        100% {
          opacity: 0;
          transform: scale(1.1);
        }
      }

      /* Glass morphism effect */
      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
      }

      /* Form styling */
      .form-input {
        width: 100%;
        padding: 12px 16px 12px 44px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        background: rgba(255, 255, 255, 1);
        transform: translateY(-2px);
      }

      .form-label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
      }

      .btn-primary {
        width: 100%;
        background: linear-gradient(to right, #2563eb, #1d4ed8);
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
      }

      .btn-primary:hover {
        background: linear-gradient(to right, #1d4ed8, #1e40af);
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        width: 100%;
        background: #6b7280;
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        transform: translateY(0);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
      }

      .btn-secondary:hover {
        background: #4b5563;
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .floating-element {
        animation: float 6s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* Progress bar */
      .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(to right, #3b82f6, #1d4ed8);
        transition: width 0.5s ease;
        border-radius: 2px;
      }

      /* Step indicators */
      .step-indicator {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .step-indicator.active {
        background: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
      }

      .step-indicator.completed {
        background: #10b981;
      }

      /* Form step animation */
      .form-step {
        opacity: 0;
        transform: translateX(30px);
        transition: all 0.5s ease;
        display: none;
      }

      .form-step.active {
        opacity: 1;
        transform: translateX(0);
        display: block;
      }

      /* Select styling */
      select.form-input {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 12px center;
        background-repeat: no-repeat;
        background-size: 16px 16px;
        padding-right: 40px;
        appearance: none;
      }

      /* File input styling */
      .file-input-wrapper {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .file-input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 12px 16px;
        border: 2px dashed #d1d5db;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.9);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .file-input-label:hover {
        border-color: #3b82f6;
        background: rgba(255, 255, 255, 1);
      }

      .file-input-label.has-file {
        border-color: #10b981;
        background: rgba(16, 185, 129, 0.1);
      }

      .field-error {
        color: #dc2626;
        font-size: 12px;
        margin-top: 4px;
      }

      .password-requirements {
        background: #dbeafe;
        border: 1px solid #bfdbfe;
        border-radius: 8px;
        padding: 16px;
      }

      .password-requirements ul {
        list-style: none;
        padding: 0;
        margin: 8px 0 0 0;
      }

      .password-requirements li {
        color: #6b7280;
        font-size: 12px;
        margin: 4px 0;
        transition: all 0.3s ease;
      }

      .password-requirements li.valid {
        color: #10b981;
        font-weight: 500;
      }
    </style>
  </head>
  <body class="min-h-screen overflow-hidden">
    <!-- Sliding Background -->
    <div class="sliding-bg">
      <div class="slide"></div>
      <div class="slide"></div>
      <div class="slide"></div>
      <div class="slide"></div>
    </div>

    <!-- Crisis Support Banner -->
    <div
      id="crisisBanner"
      class="fixed top-0 left-0 w-full bg-red-600 text-white text-center py-2 z-50 shadow-lg"
    >
      <div class="container mx-auto px-4">
        <p class="flex items-center justify-center gap-x-2 text-sm md:text-base">
          <span class="flex items-center">
            <svg class="w-4 h-4 md:w-5 md:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
            Need Help? Call our 24/7 Crisis Line:
          </span>
          <a href="tel:0800-21-21-21" class="underline font-semibold hover:text-red-200 transition">(0800)-21-21-21</a>
          <button id="closeCrisisBanner" class="text-white hover:text-red-200 transition ml-4" title="Close crisis banner">
            <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </p>
      </div>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 pt-20">
      <div class="max-w-md w-full space-y-8">
        <!-- Logo Section -->
        <div class="text-center floating-element">
          <div class="flex items-center justify-center mb-6">
            <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center shadow-lg">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
              </svg>
            </div>
            <span class="ml-3 text-3xl font-bold text-white">MindCare</span>
          </div>
          <h2 class="text-2xl font-bold text-white mb-2">Join Our Community</h2>
          <p class="text-blue-100 text-center">Take the first step towards better mental health</p>
        </div>

        <!-- Progress Section -->
        <div class="mb-8">
          <div class="flex justify-between items-center mb-4">
            <div class="step-indicator active" id="step1-indicator">1</div>
            <div class="step-indicator" id="step2-indicator">2</div>
            <div class="step-indicator" id="step3-indicator">3</div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 33.33%"></div>
          </div>
          <p class="text-center text-white text-sm mt-2" id="step-title">Personal Information</p>
        </div>

        <!-- Registration Form -->
        <div class="glass-card rounded-2xl p-8 shadow-2xl">
          <form id="registrationForm" action="{% url 'accounts:register' %}"enctype="multipart/form-data" >
             {% csrf_token %}
            <!-- Error Display -->
            <div id="errorContainer" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
              <div class="flex">
                <svg class="w-5 h-5 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                <div class="text-red-700 text-sm" id="errorText"></div>
              </div>
            </div>

            <!-- Step 1: Personal Information -->
            <div class="form-step active" id="step1">
              <div class="space-y-6">
                <div>
                  <label for="username" class="form-label">Username *</label>
                  <div class="relative">
                    <input type="text" id="username" name="username" required class="form-input" placeholder="Choose a username" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="email" class="form-label">Email Address *</label>
                  <div class="relative">
                    <input type="email" id="email" name="email" required class="form-input" placeholder="Enter your email" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="phone" class="form-label">Phone Number *</label>
                  <div class="relative">
                    <input type="tel" id="phone" name="phone" required class="form-input" placeholder="Enter your phone number" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                    </svg>
                  </div>
                </div>
              </div>

              <div class="mt-8">
                <button type="button" class="btn-primary" onclick="nextStep()">
                  <span class="flex items-center justify-center">
                    Next Step
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </span>
                </button>
              </div>
            </div>

            <!-- Step 2: Profile Details -->
            <div class="form-step" id="step2">
              <div class="space-y-6">
                <div>
                  <label for="gender" class="form-label">Gender *</label>
                  <div class="relative">
                    <select id="gender" name="gender" required class="form-input">
                      <option value="">Select your gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="age_category" class="form-label">Age Category</label>
                  <div class="relative">
                    <select id="age_category" name="age_category" class="form-input">
                      <option value="">Select age range</option>
                      <option value="13-17">13-19</option>
                      <option value="18-25">20-35</option>
                      <option value="26-35">35+</option>
                    </select>
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="location" class="form-label">Location *</label>
                  <div class="relative">
                    <input type="text" id="location" name="location" required class="form-input" placeholder="Enter your location" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="profile_image" class="form-label">Profile Image</label>
                  <div class="file-input-wrapper">
                    <input type="file" id="profile_image" name="profile_image" class="file-input" accept="image/*" onchange="handleFileSelect(this)" />
                    <label for="profile_image" class="file-input-label" id="file-label">
                      <svg class="w-6 h-6 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      <span id="file-text">Choose profile image</span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="flex space-x-4 mt-8">
                <button type="button" class="btn-secondary" onclick="prevStep()">
                  <span class="flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Previous
                  </span>
                </button>
                <button type="button" class="btn-primary" onclick="nextStep()">
                  <span class="flex items-center justify-center">
                    Next Step
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </span>
                </button>
              </div>
            </div>

            <!-- Step 3: Security -->
            <div class="form-step" id="step3">
              <div class="space-y-6">
                <div>
                  <label for="password1" class="form-label">Password *</label>
                  <div class="relative">
                    <input type="password" id="password1" name="password1" required class="form-input" placeholder="Create a strong password" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                  </div>
                </div>

                <div>
                  <label for="password2" class="form-label">Confirm Password *</label>
                  <div class="relative">
                    <input type="password" id="password2" name="password2" required class="form-input" placeholder="Confirm your password" />
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                  </div>
                </div>

                <div class="password-requirements">
                  <div class="flex">
                    <svg class="w-5 h-5 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    <div class="text-blue-700 text-sm password-requirements">
                      <p class="font-medium">Password Requirements:</p>
                      <ul class="mt-2 text-xs space-y-1">
                        <li>• At least 8 characters long</li>
                        <li>• Contains uppercase and lowercase letters</li>
                        <li>• Contains at least one number</li>
                        <li>• Contains at least one special character</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <div class="flex space-x-4 mt-8">
                <button
                  type="button"
                  class="btn-secondary"
                  onclick="prevStep()"
                >
                  <span class="flex items-center justify-center">
                    <svg
                      class="w-5 h-5 mr-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 19l-7-7 7-7"
                      ></path>
                    </svg>
                    Previous
                  </span>
                </button>
                <button type="submit" class="btn-primary" id="submit-btn">
                  <span class="flex items-center justify-center">
                    Create Account
                    <svg
                      class="w-5 h-5 ml-2"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </span>
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Sign In Link -->
        <div class="text-center">
          <p class="text-white text-sm">
            Already have an account? 
            <a href="{% url 'accounts:login' %}" class="text-blue-300 hover:text-blue-200 underline font-medium">
              Sign in here
            </a>
          </p>
        </div>
      </div>
    </div>

   <script>
  // Multi-Step Registration Form JavaScript
  let currentStep = 1;
  const totalSteps = 3;

  document.addEventListener("DOMContentLoaded", function () {
    initializeCrisisBanner();
    initializeFormValidation();
    initializeMultiStepForm();
    initializePasswordValidation();
    updateStepDisplay();
    updateProgressIndicator();

    // ✅ Fixed form submission handler
    const form = document.getElementById("registrationForm");
    if (form) {
      form.addEventListener("submit", function (e) {
        handleFormSubmission(e); 
      });
    }
  });

  function initializeCrisisBanner() {
    const closeBanner = document.getElementById("closeCrisisBanner");
    const banner = document.getElementById("crisisBanner");
    if (closeBanner && banner) {
      closeBanner.addEventListener("click", function () {
        banner.style.display = "none";
        window.crisisBannerClosed = true;
      });
      if (window.crisisBannerClosed) {
        banner.style.display = "none";
      }
    }
  }

  function initializeFormValidation() {
    const form = document.getElementById("registrationForm");
    if (form) {
      form.addEventListener("submit", function (e) {
        if (!validateForm(form)) {
          e.preventDefault();
        }
      });
    }
  }

  function validateForm(form) {
    let isValid = true;
    const requiredFields = form.querySelectorAll("[required]");
    requiredFields.forEach((field) => {
      if (!field.value.trim()) {
        showFieldError(field, "This field is required");
        isValid = false;
      } else {
        clearFieldError(field);
      }
    });
    const emailFields = form.querySelectorAll('input[type="email"]');
    emailFields.forEach((field) => {
      if (field.value && !isValidEmail(field.value)) {
        showFieldError(field, "Please enter a valid email address");
        isValid = false;
      }
    });
    const password1 = form.querySelector('input[name="password1"]');
    const password2 = form.querySelector('input[name="password2"]');
    if (password1 && password2 && password1.value !== password2.value) {
      showFieldError(password2, "Passwords do not match");
      isValid = false;
    }
    return isValid;
  }

  function showFieldError(field, message) {
    clearFieldError(field);
    const errorElement = document.createElement("div");
    errorElement.className = "field-error";
    errorElement.style.color = "#dc2626";
    errorElement.style.fontSize = "12px";
    errorElement.style.marginTop = "4px";
    errorElement.textContent = message;
    field.parentNode.appendChild(errorElement);
    field.style.borderColor = "#dc2626";
  }

  function clearFieldError(field) {
    const errorElement = field.parentNode.querySelector(".field-error");
    if (errorElement) errorElement.remove();
    field.style.borderColor = "#d1d5db";
  }

  function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  function initializeMultiStepForm() {
    updateStepDisplay();
    updateProgressIndicator();
  }

  function nextStep() {
    if (currentStep < totalSteps && validateCurrentStep()) {
      currentStep++;
      updateStepDisplay();
      updateProgressIndicator();
      scrollToTop();
    }
  }

  function prevStep() {
    if (currentStep > 1) {
      currentStep--;
      updateStepDisplay();
      updateProgressIndicator();
      scrollToTop();
    }
  }

  function validateCurrentStep() {
    const currentStepElement = document.getElementById(`step${currentStep}`);
    if (!currentStepElement) return true;

    const requiredFields = currentStepElement.querySelectorAll("[required]");
    let isValid = true;

    requiredFields.forEach((field) => {
      if (!field.value.trim()) {
        showFieldError(field, "This field is required");
        isValid = false;
      } else {
        clearFieldError(field);
      }
    });

    if (currentStep === 1) {
      const emailField = currentStepElement.querySelector('input[type="email"]');
      if (emailField && emailField.value && !isValidEmail(emailField.value)) {
        showFieldError(emailField, "Please enter a valid email address");
        isValid = false;
      }
    }

    return isValid;
  }

  function updateStepDisplay() {
    document.querySelectorAll(".form-step").forEach((step, index) => {
      step.classList.toggle("active", index + 1 === currentStep);
    });

    const stepTitles = ["Personal Information", "Profile Details", "Security"];
    const stepTitleElement = document.getElementById("step-title");
    if (stepTitleElement) {
      stepTitleElement.textContent = stepTitles[currentStep - 1];
    }
  }

  function updateProgressIndicator() {
    for (let i = 1; i <= totalSteps; i++) {
      const indicator = document.getElementById(`step${i}-indicator`);
      if (indicator) {
        indicator.classList.remove("active", "completed");
        if (i < currentStep) indicator.classList.add("completed");
        else if (i === currentStep) indicator.classList.add("active");
      }
    }

    const progressFill = document.getElementById("progress-fill");
    if (progressFill) {
      progressFill.style.width = (currentStep / totalSteps) * 100 + "%";
    }
  }

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function handleFileSelect(input) {
    const fileLabel = document.getElementById("file-label");
    const fileText = document.getElementById("file-text");
    if (input.files && input.files[0]) {
      fileText.textContent = input.files[0].name;
      fileLabel.classList.add("has-file");
    } else {
      fileText.textContent = "Choose profile image";
      fileLabel.classList.remove("has-file");
    }
  }

  function checkPasswordStrength(password) {
    const requirements = {
      length: password.length >= 8,
      uppercase: /[A-Z]/.test(password),
      lowercase: /[a-z]/.test(password),
      number: /\d/.test(password),
      special: /[!@#$%^&*(),.?":{}|<>]/.test(password),
    };
    const strength = Object.values(requirements).filter(Boolean).length;
    return { requirements, strength, score: strength / 5 };
  }

  function initializePasswordValidation() {
    const passwordField = document.querySelector('input[name="password1"]');
    if (passwordField) {
      passwordField.addEventListener("input", function () {
        const strength = checkPasswordStrength(this.value);
        updatePasswordRequirements(strength.requirements);
      });
    }
  }

  function updatePasswordRequirements(requirements) {
    const items = document.querySelectorAll(".password-requirements ul li");
    const checks = [
      requirements.length,
      requirements.uppercase && requirements.lowercase,
      requirements.number,
      requirements.special,
    ];

    items.forEach((item, index) => {
      item.style.color = checks[index] ? "#10b981" : "#6b7280";
      item.style.fontWeight = checks[index] ? "500" : "400";
    });
  }

  function handleFormSubmission(e) {
    e.preventDefault();
    const form = document.getElementById("registrationForm");
    const submitButton = document.getElementById("submit-btn");
    const errorContainer = document.getElementById("errorContainer");
    const errorText = document.getElementById("errorText");
    const originalHTML = submitButton.innerHTML;

    errorContainer.classList.add("hidden");
    errorText.textContent = "";

    submitButton.disabled = true;
    submitButton.innerHTML = `
      <span class="flex items-center justify-center">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        Creating Account...
      </span>`;

    const formData = new FormData(form);
    const csrfToken = form.querySelector('input[name="csrfmiddlewaretoken"]').value;

    fetch(form.action, {
      method: "POST",
      headers: {
        "X-CSRFToken": csrfToken,
      },
      body: formData,
    })
      .then((response) => {
        if (response.ok) return response.json();
        throw new Error("Submission failed");
      })
      .then((data) => {
        if (data.success) {
          showAlert("Account created successfully!", "success");
          form.reset();
          window.location.href = "{% url 'accounts:login' %}"; // ✅ Redirect after success
        } else if (data.errors) {
          errorContainer.classList.remove("hidden");
          errorText.innerHTML = data.errors.join("<br>");
        } else {
          showAlert("An unknown error occurred", "error");
        }
      })
      .catch((error) => {
        console.error("Submission error:", error);
        showAlert("There was an error submitting the form.", "error");
      })
      .finally(() => {
        submitButton.disabled = false;
        submitButton.innerHTML = originalHTML;
      });
  }

  function showAlert(message, type = "error") {
    const alertHTML = `
      <div class="fixed top-20 right-4 z-50 max-w-sm w-full bg-white rounded-lg shadow-lg border-l-4 ${
        type === "error" ? "border-red-500" : "border-green-500"
      } p-4">
        <div class="flex">
          <svg class="w-5 h-5 ${
            type === "error" ? "text-red-500" : "text-green-500"
          } mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="${
                type === "error"
                  ? "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"
                  : "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              }"></path>
          </svg>
          <div class="text-sm text-gray-700">${message}</div>
        </div>
      </div>`;
    document.querySelectorAll(".fixed.top-20.right-4").forEach((el) => el.remove());
    document.body.insertAdjacentHTML("beforeend", alertHTML);
    setTimeout(() => {
      const alert = document.querySelector(".fixed.top-20.right-4");
      if (alert) alert.remove();
    }, 5000);
  }

  window.nextStep = nextStep;
  window.prevStep = prevStep;
  window.handleFileSelect = handleFileSelect;
  window.showAlert = showAlert;
</script>

  </body>